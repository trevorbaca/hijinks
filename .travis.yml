version: ~> 1.0

os: linux

dist: xenial

language: python

python:
    - 3.7
    - 3.8

git:
    depth: false

before_install:
    # alias package:
    - name=hijinks

    # install lilypond:
    - lilypond=/tmp/lilypond
    - lilypond_url=http://lilypond.org/download/binaries/linux-64/
    - lilypond_source=lilypond-2.19.84-1.linux-64.sh
    - wget -q -O $lilypond $lilypond_url/$lilypond_source
    - sh $lilypond --batch

    # clone & install abjad dev branch:
    - abjad=/tmp/abjad
    - git clone -b trevor/dev https://github.com/Abjad/abjad.git $abjad
    - pip install $abjad

    # clone & install rmakers:
    - rmakers=/tmp/abjad-ext-rmakers
    - git clone https://github.com/Abjad/abjad-ext-rmakers.git $rmakers
    - pip install $rmakers

    # clone & install baca:
    - baca=/tmp/baca
    - git clone https://github.com/trevorbaca/baca.git $baca
    - pip install $baca

    # clone & install baca test:
    - test=/tmp/test
    - git clone https://github.com/trevorbaca/test.git $test
    - unlink $TRAVIS_BUILD_DIR/$name/test.py
    - ln -s $test/test_segments.py $TRAVIS_BUILD_DIR/$name/test.py

    # clone & install ide:
    - ide=/tmp/ide
    - git clone https://github.com/Abjad/ide.git $ide
    - pip install $ide

    # configure mypy:
    - export MYPYPATH=$abjad:$rmakers:$baca:$ide
    - ln -s $baca/dotfiles/mypy.ini ~/.mypy.ini

    # log environment variables
    - echo $MYPYPATH
    - echo $PATH
    - echo $PYTHONPATH
    - echo $TRAVIS_BUILD_DIR

install:
    # install package
    - pip install -e .

    # prime abjad parser tables
    - $abjad/scr/devel/prime-parser-tables

    # log versions
    - black --version
    - flake8 --version
    - isort --version
    - mypy --version
    - pytest --version

script:
    - $baca/scr/black-check $TRAVIS_BUILD_DIR/$name
    - $baca/scr/flake8-check $TRAVIS_BUILD_DIR/$name
    - $baca/scr/isort-check $TRAVIS_BUILD_DIR/$name
    - mypy $TRAVIS_BUILD_DIR/$name
    - $baca/scr/baca-doctest $TRAVIS_BUILD_DIR/$name
    - py.test -rf $TRAVIS_BUILD_DIR/$name/test.py

notifications:
    email: false
